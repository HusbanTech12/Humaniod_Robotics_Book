# Isaac ROS Camera Calibration Configuration
# Calibration parameters for RGB and depth cameras used in the Isaac ROS perception pipeline

camera_calibration:
  # RGB Camera Calibration Parameters
  rgb_camera:
    camera_name: "rgb_camera"
    camera_model: "pinhole"  # Camera model: pinhole, fisheye, omnidirectional
    image_width: 640  # Image width in pixels
    image_height: 480  # Image height in pixels

    # Intrinsic parameters
    intrinsic_matrix:
      rows: 3
      cols: 3
      data: [320.0, 0.0, 320.0,    # [fx, 0, cx]
            0.0, 320.0, 240.0,     # [0, fy, cy]
            0.0, 0.0, 1.0]         # [0, 0, 1]

    # Projection matrix (for rectified images)
    projection_matrix:
      rows: 3
      cols: 4
      data: [320.0, 0.0, 320.0, 0.0,    # [fx, 0, cx, Tx]
            0.0, 320.0, 240.0, 0.0,     # [0, fy, cy, Ty]
            0.0, 0.0, 1.0, 0.0]         # [0, 0, 1, Tz]

    # Rectification matrix (identity for pinhole model)
    rectification_matrix:
      rows: 3
      cols: 3
      data: [1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0]

    # Distortion parameters
    distortion_model: "plumb_bob"  # Distortion model: plumb_bob, rational_polynomial, equidistant, fisheye
    distortion_coefficients:
      rows: 1
      cols: 5
      data: [-0.17027, 0.0266, 0.00036, -0.0001, -0.0025]  # [k1, k2, p1, p2, k3]

    # Additional distortion coefficients for rational_polynomial model
    distortion_coefficients_rational:
      rows: 1
      cols: 8
      data: [-0.17027, 0.0266, 0.00036, -0.0001, -0.0025, 0.0, 0.0, 0.0]  # [k1, k2, p1, p2, k3, k4, k5, k6]

    # Camera frame
    camera_frame_id: "camera_rgb_optical_frame"
    baseline: 0.0  # Baseline for stereo (meters)

    # Calibration information
    calibration_time: "2025-01-01T00:00:00Z"
    calibration_process: "Isaac Sim automatic calibration"
    calibration_tool: "Isaac Sim Calibration Tool"
    calibration_version: "1.0.0"

  # Depth Camera Calibration Parameters
  depth_camera:
    camera_name: "depth_camera"
    camera_model: "pinhole"
    image_width: 640  # Image width in pixels
    image_height: 480  # Image height in pixels

    # Intrinsic parameters (should match RGB camera for alignment)
    intrinsic_matrix:
      rows: 3
      cols: 3
      data: [320.0, 0.0, 320.0,    # [fx, 0, cx]
            0.0, 320.0, 240.0,     # [0, fy, cy]
            0.0, 0.0, 1.0]         # [0, 0, 1]

    # Projection matrix
    projection_matrix:
      rows: 3
      cols: 4
      data: [320.0, 0.0, 320.0, 0.0,
            0.0, 320.0, 240.0, 0.0,
            0.0, 0.0, 1.0, 0.0]

    # Rectification matrix
    rectification_matrix:
      rows: 3
      cols: 3
      data: [1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0]

    # Distortion parameters (typically minimal for depth cameras)
    distortion_model: "plumb_bob"
    distortion_coefficients:
      rows: 1
      cols: 5
      data: [0.0, 0.0, 0.0, 0.0, 0.0]  # Usually minimal distortion for depth cameras

    # Camera frame
    camera_frame_id: "camera_depth_optical_frame"
    baseline: 0.0  # Baseline for stereo (meters)

    # Calibration information
    calibration_time: "2025-01-01T00:00:00Z"
    calibration_process: "Isaac Sim automatic calibration"
    calibration_tool: "Isaac Sim Calibration Tool"
    calibration_version: "1.0.0"

  # Stereo Camera Pair Calibration (for RGB-D alignment)
  stereo_calibration:
    enable_stereo_calibration: false  # Enable stereo calibration parameters
    left_camera_name: "rgb_camera"
    right_camera_name: "depth_camera"  # For RGB-D, depth is treated as "right" camera

    # Relative pose between cameras (extrinsics)
    rotation:
      rows: 3
      cols: 3
      data: [1.0, 0.0, 0.0,    # Rotation matrix
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0]

    translation:
      rows: 3
      cols: 1
      data: [0.0, 0.0, 0.0]    # Translation vector [x, y, z] in meters

    # Essential matrix
    essential_matrix:
      rows: 3
      cols: 3
      data: [0.0, 0.0, 0.0,
            0.0, 0.0, 0.0,
            0.0, 0.0, 0.0]

    # Fundamental matrix
    fundamental_matrix:
      rows: 3
      cols: 3
      data: [0.0, 0.0, 0.0,
            0.0, 0.0, 0.0,
            0.0, 0.0, 0.0]

    # Stereo rectification parameters
    stereo_rectification:
      left_rectification_matrix:
        rows: 3
        cols: 3
        data: [1.0, 0.0, 0.0,
              0.0, 1.0, 0.0,
              0.0, 0.0, 1.0]
      right_rectification_matrix:
        rows: 3
        cols: 3
        data: [1.0, 0.0, 0.0,
              0.0, 1.0, 0.0,
              0.0, 0.0, 1.0]
      left_projection_matrix:
        rows: 3
        cols: 4
        data: [320.0, 0.0, 320.0, 0.0,
              0.0, 320.0, 240.0, 0.0,
              0.0, 0.0, 1.0, 0.0]
      right_projection_matrix:
        rows: 3
        cols: 4
        data: [320.0, 0.0, 320.0, -320.0,  # Tx = -fx * baseline
              0.0, 320.0, 240.0, 0.0,
              0.0, 0.0, 1.0, 0.0]

  # Camera mount parameters
  mount_parameters:
    camera_mount_height: 1.0  # Height of camera mount above ground (meters)
    camera_mount_angle: 0.0   # Tilt angle of camera (radians, positive = looking down)
    camera_horizontal_fov: 60.0  # Horizontal field of view (degrees)
    camera_vertical_fov: 45.0    # Vertical field of view (degrees)

    # Mount position relative to robot base
    mount_position:
      x: 0.1    # Forward offset from base (meters)
      y: 0.0    # Lateral offset from base (meters)
      z: 0.8    # Vertical offset from base (meters)

    # Mount orientation relative to robot base
    mount_orientation:
      roll: 0.0   # Roll angle (radians)
      pitch: 0.0  # Pitch angle (radians)
      yaw: 0.0    # Yaw angle (radians)

  # Camera performance parameters
  performance_parameters:
    # Exposure settings
    exposure_mode: "auto"  # auto, manual, aperture_priority, shutter_priority
    exposure_time: 0.0333  # Exposure time in seconds (for manual mode)
    auto_exposure_time_range: [0.001, 0.1]  # Range for auto exposure (seconds)
    gain: 1.0  # Camera gain
    auto_gain_range: [0.5, 2.0]  # Range for auto gain

    # Image quality settings
    brightness: 0.0  # Brightness adjustment (-1.0 to 1.0)
    contrast: 1.0    # Contrast adjustment (0.0 to 2.0)
    saturation: 1.0  # Saturation adjustment (0.0 to 2.0)
    sharpness: 1.0   # Sharpness adjustment (0.0 to 2.0)

    # Noise parameters
    noise_model: "gaussian"  # Noise model: gaussian, poisson, salt_pepper
    noise_std_dev: 0.01      # Standard deviation of noise
    noise_mean: 0.0          # Mean of noise distribution

  # Calibration validation parameters
  validation_parameters:
    reprojection_error_threshold: 1.0  # Maximum acceptable reprojection error (pixels)
    calibration_samples: 50            # Number of calibration samples used
    calibration_accuracy: "high"       # Calibration accuracy: low, medium, high
    validation_metrics:
      mean_reprojection_error: 0.5     # Actual mean reprojection error (pixels)
      max_reprojection_error: 0.8      # Maximum reprojection error (pixels)
      calibration_score: 0.95          # Overall calibration quality score (0.0-1.0)

  # Isaac Sim specific parameters
  isaac_sim_parameters:
    # Camera properties in Isaac Sim
    isaac_sim_camera_properties:
      focal_length: 0.02  # Focal length in meters
      horizontal_aperture: 0.036  # Horizontal aperture in meters
      vertical_aperture: 0.024    # Vertical aperture in meters
      focus_distance: 1.0         # Focus distance in meters
      f_stop: 1.4                 # Aperture size
      shutter_speed: 0.0333       # Shutter speed in seconds
      sensitivity: 100            # ISO sensitivity

    # Render settings
    render_settings:
      enable_denoising: true      # Enable path tracing denoising
      max_surface_bounces: 4      # Maximum surface bounces for lighting
      enable_motion_blur: false   # Enable motion blur
      enable_fxaa: true           # Enable fast approximate anti-aliasing
      render_mode: "raytraced"    # Rendering mode: raytraced, rasterized

  # ROS topic configuration
  ros_topics:
    rgb_image_topic: "camera/rgb/image_raw"
    rgb_camera_info_topic: "camera/rgb/camera_info"
    depth_image_topic: "camera/depth/image_raw"
    depth_camera_info_topic: "camera/depth/camera_info"
    rectified_image_topic: "camera/rgb/image_rect_color"
    rectified_depth_topic: "camera/depth/image_rect_raw"

# ROS 2 node configuration
ros_config:
  node_name: "isaac_ros_camera_calibration"
  namespace: "humanoid_robot"
  use_sim_time: true  # Use simulation time in Isaac Sim environment
  qos_overrides:
    /parameter_events:
      publisher:
        history: "keep_last"
        depth: 1000
        reliability: "reliable"
        durability: "volatile"